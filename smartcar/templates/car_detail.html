{% extends './common/base.html' %}

{% block contents %}

{% if user.is_authenticated %}
    {% else %}
        <script>
        window.location.href =  "{% url 'auth' %}";
        </script>
{% endif %}

<!-- {% if request.user.is_staff %}
관리자모드
{% endif %} -->
<div id="sidebar-wrapper">

    <div id="detail-side1">
    <h2>SEC-1</h2>
    <h3>3 min 42 s</h3>
        <div></div>
    <p>200m[50/150]</p>                

    </div>
    <div id="detail-side2">

    </div>
    <div id="detail-side3">
        <div>{{ carNumber }}</div>
        컨테이너번호:<span id="container"></span><br>
        속도:<span id="speed"></span><br>
        배터리:<span id="battery"></span><br>
        통신상태:<span id="communication"></span><br>
        주행모드:<span id="drivingmode"></span><br>
    </div>
</div><!-- /#sidebar-wrapper -->

<!-- Page Content -->
<div id="page-content-wrapper">
    <div class="container-fluid">
      <br>
      <a href="/main">메인으로가기</a><br>

      <input type="hidden" id="test" value="{{ carNumber }}">

      <div id="map"></div>
      <button id="manual" onclick="manual()">수동모드</button>
      <button id="auto" onclick="auto()">자동모드</button><br>
<script>
    function search(){
    $.ajax({
            type : 'POST',
            url : 'http://127.0.0.1:8000/map/path',
            data : {
            },
            dataType:'json',
            success: function(){
            }
        });
    }

</script>

      <div id="control">
      <button id="go" onclick="go()">직진</button>
      <button id="back" onclick="back()">후진</button>
      <button id="right" onclick="right()">우회전</button>
      <button id="left" onclick="left()">좌회전</button>
      </div>


    </div>
</div> <!-- /#page-content-wrapper -->





<script>
$(document).ready(function(){
    $("#control").fadeOut("fast");
})
function manual(){
    $("#drivingmode").text('수동');
    $("#control").fadeIn("fast");
}
function auto(){
    $("#drivingmode").text('자동');
    $("#control").fadeOut('fast');
}
function go(){
var a = '1 '
        $.ajax({
            type : 'POST',
            url : 'http://192.168.0.9:8000',
            dataType:'json',
            data : {
            'bbb': a
            },
            success: function(){
            }
        });
}
function back(){
var a = '4 '
        $.ajax({
            type : 'POST',
            url : 'http://192.168.0.9:8000',
            dataType:'json',
            data : {
            'bbb': a
            },
            success: function(){
            }
        });
}
function right(){
var a = '2 '
        $.ajax({
            type : 'POST',
            url : 'http://192.168.0.9:8000',
            dataType:'json',
            data : {
            'bbb': a
            },
            success: function(){
            }
        });
}
function left(){
var a = '3 '
        $.ajax({
            type : 'POST',
            url : 'http://192.168.0.9:8000',
            dataType:'json',
            data : {
            'bbb': a
            },
            success: function(){
            }
        });
}
    var filtered_json = new Array();
    $.ajax({
                 url : "http://127.0.0.1:8000/api/CarInfo/?format=json",
                 dataType : 'json',
                 success : function (data) {
                    var my_json = JSON.stringify(data)
                    filtered_json = find_in_object(JSON.parse(my_json), {carnumber: {{ carNumber }} });
                    var container = filtered_json[0].container;
                    var speed = filtered_json[0].speed;
                    var battery = filtered_json[0].battery;
                    var communication = filtered_json[0].communication;
                    var drivingmode = filtered_json[0].drivingmode;
                    $("#container").text(container);
                    $("#speed").text(speed);
                    $("#battery").text(battery);
                    $("#communication").text(communication);
                    $("#drivingmode").text(drivingmode);
                 }
      });


function find_in_object(my_object, my_criteria){
  return my_object.filter(function(obj) {
    return Object.keys(my_criteria).every(function(c) {
      return obj[c] == my_criteria[c];
    });
  });
}
</script>


{% endblock %}